# QRコード出席確認システム

QRコードを使用したシンプルな出席確認システムです。学生がQRコードを生成し、教員がカメラでスキャンして出席を記録します。**学生リスト機能**で、登録学生のみの受付や一人一回の厳密な管理が可能です。

## 📱 クイックアクセス

### 学生用QRコード生成ページ

授業の最初に以下のQRコードをスキャンして、出席QRコード生成ページにアクセスしてください：

![学生用ページQRコード](https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://SuzukiLab-Niigata.github.io/lesson.github.io/)

または直接アクセス: `https://SuzukiLab-Niigata.github.io/lesson.github.io/`

## 概要

このシステムは2つのHTMLファイルで構成されています：

- **index.html** - 学生用QRコード生成ページ
- **teacher.html** - 教員用QRコードスキャナー（2つのモード対応）

## 主な機能

### 学生用機能（index.html）
- 学籍番号と氏名を入力してQRコードを生成
- 学籍番号は英数字のみ（リアルタイムバリデーション）
- ブラウザ上で完結（インストール不要）
- スマートフォン対応

### 教員用機能（teacher.html）

#### 2つのモード

**🔓 オープンモード（学生リストなし）**
- 誰でも出席登録可能
- QRコードデータ全体で重複チェック
- 自由参加の講演会やオープンキャンパスに最適

**🔒 登録制モード（学生リストあり）**
- CSVで学生リストをアップロード
- **登録学生のみ受け付け**
- **学籍番号で一人一回を厳密に管理**
- 出席・未出席を一覧表示
- リアルタイム統計（総数/出席/未出席）
- 通常の授業や試験に最適

#### 共通機能
- カメラでQRコードをスキャン
- リアルタイムで出席者リストを表示
- CSV形式でダウンロード（日付・時刻付き）
- データクリア機能
- サンプルCSVダウンロード

## 使い方

### 学生側の操作

1. 上記のQRコードまたはURLから`index.html`にアクセス
2. 学籍番号を入力（例: F24001）
   - 半角英数字のみ入力可能
   - 全角文字は自動的に削除されます
3. 氏名を入力（例: 山田太郎）
   - カンマ（,）は使用できません
4. 「QRコードを作成」ボタンをクリック
5. 表示されたQRコードを教員に提示

### 教員側の操作

#### オープンモード（学生リストなし）

1. `teacher.html`を開く
2. カメラへのアクセス許可を承認
3. 学生が提示するQRコードをカメラでスキャン
4. スキャンされた学生情報が自動的にリストに追加される
5. 授業終了後、「CSVで保存」ボタンをクリック

#### 登録制モード（学生リストあり）

**初回セットアップ**

1. `teacher.html`を開く
2. 「サンプルCSVダウンロード」でフォーマットを確認
3. 学生リストCSVを準備（形式は下記参照）
4. 「ファイルを選択」から学生リストCSVをアップロード
5. 登録人数が表示され、「登録制モード」に切り替わる

**日常の使用**

1. カメラでQRコードをスキャン
2. 登録学生のみ受け付け（未登録者はアラート表示）
3. リアルタイムで出席状況を確認
   - 緑色の行：出席済み
   - 赤色の行：未出席
4. 統計ボックスで「出席/未出席/総数」を確認
5. 授業終了後、「CSVで保存」でダウンロード

## セットアップ

### GitHub Pagesでの公開

1. GitHubリポジトリの Settings > Pages に移動
2. Source を `main` ブランチに設定
3. 公開されたURLにアクセス
   - 学生用: `https://あなたのユーザー名.github.io/lesson.github.io/`
   - 教員用: `https://あなたのユーザー名.github.io/lesson.github.io/teacher.html`

### ローカル環境での使用

1. リポジトリをクローン
```bash
git clone https://github.com/あなたのユーザー名/lesson.github.io.git
cd lesson.github.io
```

2. ローカルサーバーを起動（カメラ使用のためHTTPS必須）
```bash
# Python 3を使用する場合
python -m http.server 8000

# またはNode.jsのhttp-serverを使用
npx http-server
```

3. ブラウザで開く
   - 学生用: `http://localhost:8000/index.html`
   - 教員用: `http://localhost:8000/teacher.html`

## データ形式

### QRコード形式
```
学籍番号,氏名
```
例: `F24001,山田太郎`

### 学生リストCSV（登録制モード用）
- **ファイル名**: 任意（例: `students.csv`）
- **エンコーディング**: UTF-8
- **形式**:
```csv
学籍番号,氏名
F24001,山田太郎
F24002,佐藤花子
F24003,鈴木一郎
```

**注意事項**:
- 1行目はヘッダー（`学籍番号,氏名`）または最初から学生データでもOK
- 学籍番号は英数字のみ
- カンマ区切り

### 出席データCSV出力
- **ファイル名**: `attendance_YYYY-MM-DD.csv`
- **エンコーディング**: UTF-8 (BOM付き)
- **列**: 学籍番号, 氏名, 日付, 時刻

例:
```csv
学籍番号,氏名,日付,時刻
F24001,山田太郎,2025/12/25,10:30:45
F24002,佐藤花子,2025/12/25,10:31:12
```

## 技術仕様

### 使用ライブラリ

- **jsQR** - QRコード読み取り
- **QRCode.js** - QRコード生成

### 対応ブラウザ

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+
- モバイルブラウザ（iOS Safari, Chrome Mobile）

### 必要な権限

- カメラアクセス（teacher.html使用時）

## 注意事項

- カメラ機能を使用するため、HTTPSまたはlocalhostでの動作が必要です
- スマートフォンで使用する場合は、背面カメラが自動的に選択されます
- 同じ学生が複数回QRコードを提示しても、1回のみ記録されます
- CSVファイルはUTF-8（BOM付き）で保存されるため、Excelでも文字化けせずに開けます
- データはブラウザ上でのみ保持されます（ページをリロードするとクリアされます）

## よくある質問（FAQ）

### Q1. 一人の学生が複数回QRコードを提示したらどうなりますか？

**オープンモード（学生リストなし）**:
- 同じ学籍番号・氏名のQRコードなら2回目以降は無視されます
- ただし、氏名の表記を変えた場合（例: `F24001,山田太郎` と `F24001,やまだたろう`）は別のQRコードとして記録されます
- **対策**: 教員が目視で確認する運用が最も効果的です

**登録制モード（学生リストあり）**:
- **学籍番号**で一人一回を厳密に管理
- 同じ学籍番号なら、氏名が違っても2回目以降は無視されます
- 一人が友達の学籍番号でQRコードを作っても、**登録学生のみ受け付ける**ため防げます

### Q2. 学生が友達の分も代理でスキャンできますか？

**オープンモード**: 異なる学籍番号なら記録されてしまいます。教員の目視確認が必要です。

**登録制モード**:
- 登録されている学籍番号のみ受け付けるため、架空の学籍番号は防げます
- ただし、正規の学生の学籍番号を使われた場合は防げません
- **対策**: 教員が学生の顔を見ながらスキャンする運用が効果的です

### Q3. データはどこに保存されますか？
データはブラウザのメモリ上にのみ保存されます。ページをリロードするとデータは消えるため、授業終了後は必ずCSVでダウンロードしてください。

### Q4. オフラインでも使用できますか？
学生用のQRコード生成はオフラインでも可能です。教員用のスキャナーもオフラインで動作しますが、初回アクセス時はインターネット接続が必要です（jsQRライブラリの読み込みのため）。

### Q5. スマートフォンでも使えますか？
はい。学生用・教員用ともにスマートフォンのブラウザで使用できます。

### Q6. 複数の授業で使用できますか？
各授業ごとに個別のCSVファイルをダウンロードできます。学生リストも授業ごとにアップロードし直せます。授業が終わったら「出席データをクリア」ボタンでリセットしてください。

### Q7. セキュリティは大丈夫ですか？
データは外部サーバーに送信されず、すべてブラウザ上で処理されます。個人情報は安全に保護されます。

## トラブルシューティング

### カメラが起動しない
- HTTPSまたはlocalhostでアクセスしているか確認してください
- ブラウザのカメラ権限を確認してください
- 他のアプリケーションがカメラを使用していないか確認してください

### QRコードが読み取れない
- QRコードがカメラの視界に収まっているか確認してください
- 照明が十分か確認してください
- QRコードが鮮明に表示されているか確認してください

### CSVファイルが文字化けする
- Excelで開く場合、ファイルはUTF-8（BOM付き）で保存されているため、通常は文字化けしません
- もし文字化けする場合は、Excelのインポート機能を使用してください

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 改善案

- LocalStorageを使用した永続的なデータ保存
- 複数の授業・クラスを管理する機能
- 出席率の統計表示
- 遅刻の自動判定機能
- 学生リストの一括インポート
- QRコードの有効期限設定
